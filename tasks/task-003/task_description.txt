task_description: |
  Task: Calendar intelligence - ISO weeks and business-day metrics
  Instructions:
  Create fresh endpoints to calculate ISO week details - handle summaries across dates - but check everything tightly. Use straightforward rules so info fits what’s expected each time.
  Requirements (as tested):
  - POST /adv/date-metrics
    Body (JSON): {
      "start": string in YYYY-MM-DD,
      "end": string in YYYY-MM-DD,
      "holidays": optional array of YYYY-MM-DD strings (duplicates allowed)
    }
    Behavior:
    - Validate inputs. Reject when:
      - dates do not match YYYY-MM-DD or are invalid calendar dates,
      - start > end,
      - holidays is provided but not an array of YYYY-MM-DD strings
    - Respond with JSON containing:
      - days_total: total number of days in the range (inclusive)
      - business_days: count of weekdays (Mon–Fri) in the range, excluding any dates listed in holidays
      - weeks_iso: unique ISO week labels covered by the range (e.g. ["2025-W01"]). Order is not guaranteed
      - start_of_week: Monday date (YYYY-MM-DD) of the ISO week containing start
      - end_of_week: Sunday date (YYYY-MM-DD) of the ISO week containing end
        (tests only require these to enclose the [start, end] range and be valid dates)

  - GET /adv/iso-week
    Query: date=YYYY-MM-DD
    Behavior:
    - If the date is invalid, return 400
    - Respond with { "isoYear": number, "isoWeek": number, "label": "YYYY-Www" } using ISO-8601 (weeks start Monday)

  Notes:
  - Adjust these files: server/routes/advanced.js, while at it look into server/utils/date.js. Make sure everything runs smooth, so tests don’t fail.
  - Rules against cheating (need to stick to these):
    - Use basic methods instead of fixed answers for test dates.
    - Skip using lists tied to test inputs or jumps that give set answers for familiar dates.
    Your logic needs to handle any correct date from 1900 to 2100 without changes - so it runs smooth no matter the year. Instead of tweaking it each time, let it adapt on its own when faced with different dates across decades.

difficulty: hard
category: Feature
tags: [node, express, dates, algorithms]
parser_name: pytest
