task_description: |
  Task: Calendar intelligence — ISO weeks and business-day metrics
  Instructions:
  Build new endpoints to compute ISO week info and date-range metrics with strict validation.
  Requirements (as tested):
  - POST /adv/date-metrics
    Body (JSON): {
      "start": string in YYYY-MM-DD,
      "end": string in YYYY-MM-DD,
      "holidays": optional array of YYYY-MM-DD strings (may contain duplicates)
    }
    Behavior:
    - Validate inputs. Reject when:
      - any field is missing or not a string (for required fields),
      - dates do not match YYYY-MM-DD or are invalid calendar dates,
      - start > end,
      - holidays is provided but not an array of YYYY-MM-DD strings
    - Compute and return JSON with keys:
      - days_total: total number of days in the range inclusive
      - business_days: number of weekdays (Mon–Fri) in the range, excluding any dates listed in holidays
      - weeks_iso: unique ISO week identifiers covered by the range, e.g. ["2025-W01"], sorted ascending
      - start_of_week: the Monday date (YYYY-MM-DD) of the ISO week containing start
      - end_of_week: the Sunday date (YYYY-MM-DD) of the ISO week containing end

  - GET /adv/iso-week
    Query: date=YYYY-MM-DD
    Behavior:
    - Validate the date; if invalid, return 400.
    - Respond with { "isoYear": number, "isoWeek": number, "label": "YYYY-Www" } using ISO-8601 week-numbering (weeks start on Monday).

  Notes:
  - Only modify (when implementing): server/routes/advanced.js and server/utils/date.js. Keep logic well-tested and deterministic.

difficulty: hard
category: Feature
tags: [node, express, dates, algorithms]
parser_name: pytest
